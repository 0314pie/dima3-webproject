<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subheadings</title>
    
    <!--font-->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700,200" rel="stylesheet" />
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" rel="stylesheet">

    <!--css-->
    <link th:href="@{/assets/css/bootstrap.min.css}" rel="stylesheet" />
    <link th:href="@{/assets/css/with-sidebar.css}" rel="stylesheet" />

    <link th:href="@{/assets/demo/demo.css}" rel="stylesheet" />

    <!-- Resources -->
    <script src="https://cdn.amcharts.com/lib/5/index.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/xy.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/percent.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>
    <script th:src="@{/script/jquery-3.7.1.min.js}"></script>
    <script defer th:src="@{/script/imexChart.js}"></script>
    <script>
        $(function(){
            showXYChart();
            showExPieCharts();
            showImPieCharts();
        });

        function showXYChart() {
            let hscode = $("#getHs4digit").val();
            $.ajax({
                url : "/chart/imexXYChart"
                , method : "GET"
                , data : {"hs4digit" : hscode}
                , success : function(resp){
                    console.log(resp);
                    let exYearAmountList = [];
                    let imYearAmountList = [];

                    $.each(resp, function(index, item){
                        exYearAmountList.push(item["exportAmount"]);
                        imYearAmountList.push(item["importAmount"])
                    });

                    imexXYChart(exYearAmountList, imYearAmountList);
                    console.log("차트 그려짐");
                }
            });
        }

        function showExPieCharts(){
            let hscode = $("#getHs4digit").val();
            $.ajax({
                url : "/chart/exPieChart"
                , method : "GET"
                , data : {"hs4digit" : hscode}
                , success : function(resp){
                    console.log(resp);
                    let countryList = [];
                    let exRankingList = [];
                    let exAmountList = [];

                    $.each(resp, function(index, item){
                        countryList.push(item["countryName"]);
                        exRankingList.push(item["exportRanking"]);
                        exAmountList.push(item["exportAmount"])
                    });

                    exportPieChart(countryList, exRankingList, exAmountList);
                    console.log("차트 그려짐");
                }
            });
        }

        function showImPieCharts() {
            let hscode = $("#getHs4digit").val();
            $.ajax({
                url : "/chart/imPieChart"
                , method : "GET"
                , data : {"hs4digit" : hscode}
                , success : function(resp){
                    console.log(resp);
                    let countryList = [];
                    let imRankingList = [];
                    let imAmountList = [];

                    $.each(resp, function(index, item){
                        countryList.push(item["countryName"]);
                        imRankingList.push(item["importRanking"]);
                        imAmountList.push(item["importAmount"])
                    });

                    importPieChart(countryList, imRankingList, imAmountList);
                    console.log("차트 그려짐");
                }
            });
        };
    </script>
    <style>
        #chartdiv1 {
            display: inline-block;
            width: 400px;
            height: 300px;
        }
        #chartdiv2 {
            display: inline-block;
            width: 400px;
            height: 300px;
        }
        #chartdiv3 {
            display: inline-block;
            width: 400px;
            height: 300px;
        }
    </style>
</head>
<body class="index-page sidebar-collapse">

    <!--========= main 내용 시작 ==========-->
    <div class="main-contents-container">
        <div id="chartdiv1"></div>
        <div id="chartdiv2"></div>
        <div id="chartdiv3"></div>

        <input type="hidden" th:value="${hs4digit}" id="getHs4digit">
        <div class="content">
            <table border="1">
                <thead>
                    <tr>
                        <th colspan="3">품목번호</th>
                        <th>품명</th>
                    </tr>
                </thead>
                <tbody th:each="subhead : ${list}">
                    <tr>
                        <td rowspan="2" th:text="${hs4digit}"></td>
                        <td rowspan="2" th:text="${subhead.hs6digit}"></td>

                        <!-- 조건문 시작 -->
                        <!-- 마지막 네자리가 null이 아니고 길이가 4이면 하이퍼링크 걸기-->
                        <td rowspan="2" th:if="!${#strings.isEmpty(subhead.hs10digit)} and ${#strings.length(subhead.hs10digit) == 4}">
                            <a th:href="@{/subhead/info(hsAll=${subhead.hsAll},hs4digit=${subhead.hs4digit})}" th:text="${subhead.hs10digit}"></a>
                        </td>
                        <td rowspan="2" th:unless="!${#strings.isEmpty(subhead.hs10digit)} and ${#strings.length(subhead.hs10digit) == 4}" th:text="${subhead.hs10digit}"></td>
                        <!-- 조건문 끝 -->

                        <td th:text="${subhead.koDescription}"></td>
                    </tr>
                    <tr>
                        <td colspan="4" th:text="${subhead.engDescription}"></td>
                    </tr>
                </tbody>
            </table>
        </div> <!--div.content 끝-->
    </div><!--div.main-contents-container-->


    <!--script-->
    <script th:src="@{/assets/js/core/jquery.min.js}" type="text/javascript"></script>
    <script th:src="@{/assets/js/core/popper.min.js}" type="text/javascript"></script>
    <script th:src="@{/assets/js/core/bootstrap.min.js}" type="text/javascript"></script>

    <script th:src="@{/assets/js/plugins/bootstrap-switch.js}"></script>

    <script th:src="@{/assets/js/plugins/nouislider.min.js}" type="text/javascript"></script>

    <script th:src="@{/assets/js/plugins/moment.min.js}"></script>
    <script th:src="@{/assets/js/plugins/bootstrap-datepicker.js}" type="text/javascript"></script>

    <script th:src="@{/assets/js/paper-kit.min.js?v=2.2.0}" type="text/javascript"></script>
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDTTfWur0PDbZWPr7Pmq8K3jiDp0_xUziI"></script>

</body>
</html>